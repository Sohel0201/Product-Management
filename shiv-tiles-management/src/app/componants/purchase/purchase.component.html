<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">
      <div class="card custom-card">
        <div class="card-body">
          <form>
            <div
              class="poppins-semibold text-center fw-semibold fs-3 mt-2 mb-3"
            >
              Purchase Tiles
            </div>
            <hr />
            <div class="row mb-3">
              <div class="col-2"></div>
              <div class="col-6">
                <div class="form-group">
                  <label for="tileSize" class="form-label">Tile Size</label>
                  <mat-form-field appearance="fill" class="w-100">
                    <input
                      type="text"
                      matInput
                      [formControl]="tileSizeInput"
                      [matAutocomplete]="auto"
                    />
                    <mat-autocomplete #auto="matAutocomplete">
                      <mat-option
                        *ngFor="let size of filteredTileSizes | async"
                        [value]="size.size"
                        (onSelectionChange)="selectTileSize(size)"
                      >
                        {{ size.size }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
              </div>
              <div
                class="col-3 d-flex justify-content-center align-items-center"
              >
                <button
                  type="button"
                  class="btn btn-outline-secondary btn-lg"
                  (click)="openAddTileSizeDialog()"
                >
                  Add Tile Size
                </button>
              </div>
            </div>

            <div class="row mb-3" *ngIf="tileSizeInput.value">
              <div class="col-2"></div>
              <div class="col-6">
                <div class="form-group">
                  <label for="tileDesign" class="form-label">Tile Design</label>
                  <mat-form-field appearance="fill" class="w-100">
                    <input
                      type="text"
                      matInput
                      [formControl]="tileDesignInput"
                      [matAutocomplete]="autoDesign"
                      (input)="onTileDesignInput($event)"
                    />
                    <mat-autocomplete #autoDesign="matAutocomplete">
                      <mat-option
                        *ngFor="let design of filteredTileDesigns | async"
                        [value]="design.design"
                        (onSelectionChange)="selectTileDesign(design)"
                      >
                        {{ design.design }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
              </div>
            </div>

            <div class="row mb-3" *ngIf="tileDesignInput.value">
              <div class="col-2"></div>
              <div class="col-6">
                <div class="form-group">
                  <label for="quantity" class="form-label">Quantity</label>
                  <mat-form-field appearance="fill" class="w-100">
                    <mat-label>Quantity</mat-label>
                    <input
                      matInput
                      type="number"
                      placeholder="0"
                      [disabled]="!tileDesignInput.value"
                      [formControl]="quantityInput"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <hr />
            <div class="d-flex justify-content-center mt-3">
              <button
                type="button"
                class="btn btn-outline-success btn-lg"
                (click)="purchase()"
              >
                Purchase
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="row justify-content-center">
    <div class="col-12 col-lg-12 col-lg-8">
      <!-- Table Card -->
      <div class="card custom-card-table mb-5 mx-auto" style="max-width: 100%">
        <div class="card-body">
          <div class="poppins-semibold text-center fw-semibold fs-3 mt-2 mb-3">
            Purchase Data
          </div>
          <hr />
          <div class="mt-5">
            <p-table
              [value]="purchases"
              [paginator]="true"
              [rows]="10"
              [rowsPerPageOptions]="[5, 10, 20]"
              [filterDelay]="500"
              [globalFilterFields]="[
                'tile.design',
                'tile.tileSize.size',
                'purchaseQty',
                'purchaseDate',
                'tile.stock'
              ]"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th pSortableColumn="tile.design">
                    Tile Design
                    <p-sortIcon field="tile.design"></p-sortIcon>
                  </th>
                  <th pSortableColumn="tile.tileSize.size">
                    Tile Size
                    <p-sortIcon field="tile.tileSize.size"></p-sortIcon>
                  </th>
                  <th pSortableColumn="PurchaseQty">
                    Purchase Quantity
                    <p-sortIcon field="purchaseQty"></p-sortIcon>
                  </th>
                  <th pSortableColumn="PurchaseDate">
                    Purchase Date <p-sortIcon field="purchaseDate"></p-sortIcon>
                  </th>
                  <th pSortableColumn="tile.stock">
                    Tile Stock <p-sortIcon field="tile.stock"></p-sortIcon>
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-sale>
                <tr>
                  <td>{{ purchase.tile.design }}</td>
                  <td>{{ purchase.tile.tileSize.size }}</td>
                  <td>{{ purchase.purchaseQty }}</td>
                  <td>{{ purchase.purchaseDate | date : "MM/dd/yyyy" }}</td>
                  <td>{{ purchase.tile.stock }}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="5">No Purchase found.</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
